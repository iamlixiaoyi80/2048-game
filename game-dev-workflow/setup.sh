#!/bin/bash
# æ¸¸æˆé¡¹ç›®åˆå§‹åŒ–è„šæœ¬
# ç”¨æ³•: ./setup.sh <é¡¹ç›®å> [--template æ¨¡æ¿] [--å¼•æ“ å¼•æ“]

set -e

PROJECT_NAME="${1:-MyGame}"
TEMPLATE="${3:-unity-2d}"
ENGINE="${4:-unity}"

echo "ğŸ® åˆå§‹åŒ–æ¸¸æˆé¡¹ç›®: $PROJECT_NAME"
echo "ğŸ“‹ æ¨¡æ¿: $TEMPLATE"
echo "ğŸ”§ å¼•æ“: $ENGINE"
echo ""

# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir -p "$PROJECT_NAME"
cd "$PROJECT_NAME"

# åˆå§‹åŒ–Gitä»“åº“
echo "ğŸ“¦ åˆå§‹åŒ– Git ä»“åº“..."
git init

# åˆ›å»ºæ ‡å‡†ç›®å½•ç»“æ„
echo "ğŸ“ åˆ›å»ºé¡¹ç›®ç»“æ„..."
mkdir -p src/{scripts,scenes,prefabs,assets/{sprites,audio,materials}}
mkdir -p tests/{unit,integration}
mkdir -p docs/{design,api}
mkdir -p build/{dev,prod}
mkdir -p config

# åˆ›å»ºåŸºç¡€é…ç½®æ–‡ä»¶
echo "âš™ï¸  åˆ›å»ºé…ç½®æ–‡ä»¶..."
cat > config/project.json << EOF
{
  "name": "$PROJECT_NAME",
  "version": "0.1.0",
  "engine": "$ENGINE",
  "created": "$(date -Iseconds)",
  "features": []
}
EOF

# åˆ›å»ºREADME
cat > README.md << EOF
# $PROJECT_NAME

## ğŸ® æ¸¸æˆç®€ä»‹

[TODO: æ·»åŠ æ¸¸æˆç®€ä»‹]

## ğŸš€ å¿«é€Ÿå¼€å§‹

\`\`\`bash
# å®‰è£…ä¾èµ–ï¼ˆå¦‚éœ€è¦ï¼‰
npm install

# è¿è¡Œæ¸¸æˆ
./run.sh
\`\`\`

## ğŸ“‹ ä»»åŠ¡æ¸…å•

- [ ] æ ¸å¿ƒæ¸¸æˆå¾ªç¯
- [ ] ç©å®¶æ§åˆ¶ç³»ç»Ÿ
- [ ] æ•ŒäººAI
- [ ] éŸ³æ•ˆç³»ç»Ÿ
- [ ] UIç•Œé¢

## ğŸ“„ æ–‡æ¡£

- [å¼€å‘æ–‡æ¡£](docs/DEVELOPMENT.md)
- [æµ‹è¯•æ–‡æ¡£](tests/README.md)
- [éƒ¨ç½²æ–‡æ¡£](docs/DEPLOYMENT.md)

---

*Created with OpenClaw Game Dev Workflow ğŸ¦*
EOF

# åˆ›å»ºå¼€å‘æ–‡æ¡£
cat > docs/DEVELOPMENT.md << EOF
# å¼€å‘æ–‡æ¡£

## å¼€å‘ç¯å¢ƒè®¾ç½®

### å®‰è£…è¦æ±‚
- Unity 2023.x LTSï¼ˆå¦‚æœä½¿ç”¨Unityï¼‰
- Node.js 18+ï¼ˆå¦‚æœéœ€è¦è„šæœ¬ï¼‰
- Python 3.9+ï¼ˆå¦‚æœéœ€è¦å·¥å…·ï¼‰

### å¼€å‘æµç¨‹

1. ä½¿ç”¨ \`./dev-agent.sh \"ä»»åŠ¡æè¿°\"\` å¯åŠ¨æ™ºèƒ½ä½“
2. æ™ºèƒ½ä½“ä¼šè‡ªåŠ¨ç”Ÿæˆä»£ç 
3. ä»£ç ç”Ÿæˆåè‡ªåŠ¨æäº¤
4. å®šæœŸè¿è¡Œ \`./scripts/test-agent.sh\`

## ä»£ç è§„èŒƒ

- ä½¿ç”¨é©¼å³°å‘½åæ³•
- æ¯ä¸ªç±»åº”æœ‰æ³¨é‡Š
- æäº¤ä¿¡æ¯æ ¼å¼: \`feat: æè¿°\`, \`fix: æè¿°\`, \`test: æè¿°\`

---

*Auto-generated by OpenClaw* ğŸ¦
EOF

# åˆ›å»ºæµ‹è¯•æ–‡æ¡£
cat > tests/README.md << EOF
# æµ‹è¯•æ–‡æ¡£

## æµ‹è¯•ç»“æ„

- \`tests/unit/\` - å•å…ƒæµ‹è¯•
- \`tests/integration/\` - é›†æˆæµ‹è¯•

## è¿è¡Œæµ‹è¯•

\`\`\`bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
./scripts/test-agent.sh --all

# è¿è¡Œå•å…ƒæµ‹è¯•
./scripts/test-agent.sh --unit

# è¿è¡Œé›†æˆæµ‹è¯•
./scripts/test-agent.sh --integration
\`\`\`

## æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

- å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å¿…é¡»æœ‰é›†æˆæµ‹è¯•

---

*Auto-generated by OpenClaw* ğŸ¦
EOF

# å®‰è£…GitHub Actions CI/CD
echo "ğŸ”„ é…ç½® GitHub Actions..."
mkdir -p .github/workflows
cp ../templates/github-actions/workflow.yml .github/workflows/ci-cd.yml

# åˆ›å»º.gitignore
cat > .gitignore << EOF
# Unity
[Ll]ibrary/
[Tt]emp/
[Oo]bj/
[Bb]uild/
[Bb]uilds/
[Ll]ogs/
[Mm]emory/
[Dd]ebugLog.txt

# Node
node_modules/
*.log

# Python
__pycache__/
*.pyc
.venv/

# OS
.DS_Store
Thumbs.db

# Build
build/*.unity
build/*.apk
EOF

# åˆå§‹æäº¤
echo "ğŸ“¤ åˆå§‹æäº¤..."
git add .
git commit -m "chore: initialize game project with OpenClaw workflow ğŸ¦"

echo ""
echo "âœ… é¡¹ç›®åˆå§‹åŒ–å®Œæˆï¼"
echo ""
echo "ğŸ“ å½“å‰ç›®å½•: $(pwd)"
echo ""
echo "ğŸ¯ ä¸‹ä¸€æ­¥æ“ä½œï¼š"
echo "   1. cd $PROJECT_NAME"
echo "   2. ./scripts/dev-agent.sh 'å¼€å§‹å¼€å‘æ¸¸æˆåŠŸèƒ½'"
echo "   3. ./scripts/test-agent.sh --all"
echo ""
echo "ğŸ¦ ç¥æ¸¸æˆå¼€å‘é¡ºåˆ©ï¼"
